<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<script>

var open_in_front = true; //激活新标签
var open_to_right = true; //靠右打开新标签

var g_tab;

function FindLeft(tabs) {
    var i = 0;
    if ( g_tab.index == 0 ) {
        chrome.tabs.update(tabs[tabs.length-1].id,{selected:true});
        chrome.tabs.update(g_tab.id,{selected:false});                 
    }
    else{
        while (i < tabs.length) {

                if (tabs[i].index == g_tab.index-1) {
                chrome.tabs.update(tabs[i].id,{selected:true});
                chrome.tabs.update(g_tab.id,{selected:false});               
                break;
            }
            i++;
        }
    }
}
function SelectLeft(tab) 
{
    g_tab = tab;
    chrome.tabs.getAllInWindow(null,FindLeft);
}
function FindRight(tabs) {
    var i = 0;
    if ( g_tab.index == tabs.length-1 ) {
        chrome.tabs.update(tabs[0].id,{selected:true});
        chrome.tabs.update(g_tab.id,{selected:false});              
    }
    else{
        while (i < tabs.length) {
            if (tabs[i].index == g_tab.index+1) {
                chrome.tabs.update(tabs[i].id,{selected:true});
                chrome.tabs.update(g_tab.id,{selected:false});                
                break;
            }
            i++;
        }
    }      
}
function SelectRight(tab) 
{
    g_tab = tab;
    chrome.tabs.getAllInWindow(null,FindRight);
}

function selectLeftAction() {
    chrome.tabs.getSelected(null,SelectLeft);
}

function selectRightAction() {
    chrome.tabs.getSelected(null,SelectRight);
}


// In an extension
chrome.extension.onConnect.addListener(function(port) {
  // Only accept connections with a port.name we expect.
  if (port.name != 'nkGestures')
    return; 
  port.onMessage.addListener(function(data) {
	  if (data.message == 'tab')
	  {
		  var tabindex;
		  chrome.tabs.getSelected (null, function (tab) {
			  if (open_to_right) chrome.tabs.create ({url: data.values, index: tab.index+1, selected: open_in_front});
			  else chrome.tabs.create ({url: data.values, selected: open_in_front});
		});
	  }
	  else if (data.message == 'gestures') {

	        if(data.values == "NT") {
	            if (open_to_right) chrome.tabs.getSelected( null,function(tab){chrome.tabs.create ({index:tab.index+1, selected:true},null);});
	            else chrome.tabs.create({selected:true},null);
	        }
	        else if (data.values == "CT") {
	            chrome.tabs.getSelected( null,function(tab){chrome.tabs.remove(tab.id);} );         
	        }
	        else if (data.values == "LT") {
	            selectLeftAction();           
	        }
	        else if (data.values == "RT") {
	            selectRightAction(); 
	        }
	  }
  });
});
</script>
</head>
<body></body>
</html>
