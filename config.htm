<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<script>
var nkConfig = {
    gesturesName : "GesturesArray",
    
    connection : null,
    
    gestures : null,

    opt_otr : {name: 'open_to_right', label: '在当前分页右侧打开新分页（默认在分页栏最右侧打开）'},
    
    opt_odg : {name: 'isOpenDrag', label: '是否打开拖放'},
    
    txt_link : {name:'SearchEngine', label:'搜索引擎'},
    
    actionNames :
	    new Array(
		    //newtab			: 
		    "新标签",
		    //close			: 
		    "关标签",
		    //back			: 
		    "后退",
		    //forward		    : 
		    "前进",
		    //stop			: 
		    "停止",
		    //reload		    : 
		    "重载",		
		    //reload		    : 
		    "刷新",
		    //righttab		: 
		    "右标签",
	        //lefttab		    : 
	        "左标签",
		    //firsttab		: 
		    "前端标签",
		    //lasttab		    : 
		    "后端标签"		
	    ),

    getCookie : function(c_name)
    {
        if (document.cookie.length>0)
        {
            c_start=document.cookie.indexOf(c_name + "=");
            if (c_start!=-1)
            { 
                c_start=c_start + c_name.length+1 ;
                c_end=document.cookie.indexOf(";",c_start);
                if (c_end==-1) c_end=document.cookie.length;
                return unescape(document.cookie.substring(c_start,c_end));
            } 
        }
        return "";
    },

    setCookie : function(c_name,value,expiredays)
    {
        var exdate=new Date();
        exdate.setDate(exdate.getDate()+expiredays);
        document.cookie=c_name+ "=" +escape(value)+((expiredays==null) ? "" : "; expires="+exdate.toGMTString());
        this.connection.postMessage("do:getcookie");
    },

    saveValueAndPost : function(obj)
    {
	    if (obj.checked)
	    {
		    this.setCookie (obj.id, 'enable', 365);
	    }
	    else
	    {
		    this.setCookie (obj.id, 'disable', 365);
	    }
    },
    
    checkSavedValue : function(optionname)
    {
	    var result_htm = '';
	    var value = this.getCookie (optionname);
	    if (value == 'enable')
	    {
		    result_htm = 'checked="checked" ';
	    }
	    return result_htm;
    },
    
    writeOption : function (option)
    {
	    return '<label>' + '<input onclick="nkConfig.saveValueAndPost (this)" id="' +
	    option.name + '" type="checkbox" ' + this.checkSavedValue (option.name) +
	    '/>' + option.label + '</label>';
    },
    
    writeText : function (option) {
        return '<label>' + '<input id="' + option.name + '" type="text" value="' + this.getCookie (option.name) +
        '"/>' + option.label + '</label>';        
    },
    
    saveText : function () {
        var txt = document.getElementById(this.txt_link.name).value;
        if (txt) {
            this.setCookie(this.txt_link.name,unescape(txt),365);  
        }
        this.saveGesturesValue();              
    },
    
    writeGesturesText : function ()
    {
	    var html = '';
	    var j = 0;
	    for(i=0;i<this.actionNames.length;i++)
	    {
	        var temp = '';
	        while (j<this.gestures.length && this.gestures[j]!=',') {
	            temp += this.gestures[j];
	            j++;
	        }
	        j++;
	        html += '<label>' + '<input id="' +
	        i + '" type="text" value="' + temp +
	        '"/>' + this.actionNames[i] + '</label>';	
	    }
	    return html;
    },
    
    saveGesturesValue : function()
    {
        var temp = new Array(this.actionNames.length);
        
        for(i=0;i<this.actionNames.length;i++)
        {
            var txt = document.getElementById(i);
            temp[i] = txt.value;    
        }
        this.setCookie(this.gesturesName,temp,365);
    },
    
    init : function () {
        this.gestures = this.getCookie(this.gesturesName);
        this.connection = chrome.extension.connect("nkGestures");
    }
}

window.onload=function ()
{
    nkConfig.init();
	var config = document.getElementById ('config');
	config.innerHTML += '<label><center>nkGestures for Chrome by nk</center></label>'
	config.innerHTML += nkConfig.writeOption (nkConfig.opt_odg);
	config.innerHTML += nkConfig.writeOption (nkConfig.opt_otr);
    config.innerHTML += nkConfig.writeText (nkConfig.txt_link);
	config.innerHTML += '<label>U,D,L,R 分别对应上下左右手势 可以随意组合填入文本框也可为空</label>'
	config.innerHTML += nkConfig.writeGesturesText();
	config.innerHTML += '<input type="button" id="submit1" onclick="nkConfig.saveText()" value="OK"> <input type="button" id="submit2" onclick="window.close()" value="Close">';
};
</script>
<style>
body
{
	text-align: center
}
.top
{
	padding-top:	10px;
	margin-bottom:	10px;
	height:		50px;
	font:		bold 30px sans;
	color:		#fff;
	background:	#cce
}
label
{
	display:	block
}
form
{
	margin:		auto;
	width:		500px;
	text-align:	left
}
</style>
</head>
<body>
<div class="top">手势设置</div>
<form id="config">
</form>
</body>
</html>
